<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | TBCxPayme CUP</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background: radial-gradient(circle at center, #031a1d, #010a0c);
      color: #e3f6ff;
      font-family: 'Rajdhani', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }

    h1, h2 {
      color: #00e6ff;
      text-shadow: 0 0 10px #00aaff;
    }

    input, button {
      font-family: 'Rajdhani', sans-serif;
    }

    #login-screen {
      text-align: center;
    }

    #adminPanel {
      display: none;
      width: 80%;
      max-width: 700px;
    }

    .match {
      background: rgba(0, 255, 204, 0.05);
      border: 1px solid #00ffd5;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .match input {
      width: 120px;
      padding: 5px;
      border: 1px solid #00e6ff;
      border-radius: 5px;
      background: rgba(0,0,0,0.3);
      color: white;
    }

    .match span {
      color: #00ffff;
      font-weight: bold;
    }

    #saveBtn {
      background: #00aaff;
      border: none;
      padding: 12px 24px;
      color: white;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      transition: 0.3s;
    }
    #saveBtn:hover {
      background: #0088cc;
    }

    .error-text {
      display: none;
      color: #ff5555;
      margin-top: 10px;
    }

    #status {
      margin-top: 15px;
      font-weight: bold;
    }

    #tokenInput {
      width: 300px;
      padding: 8px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div id="login-screen">
    <h2>üîí –í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
    <input type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" /><br><br>
    <button onclick="login()">–í–æ–π—Ç–∏</button>
    <p id="error" class="error-text">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</p>
  </div>

  <div id="adminPanel">
    <h1>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ç—É—Ä–Ω–∏—Ä–∞</h1>

    <label>üîë GitHub Token:</label><br>
    <input type="password" id="tokenInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à GitHub Token"><br>
    <button onclick="loadData()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

    <div id="matchContainer"></div>
    <button id="saveBtn" onclick="saveData()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <p id="status"></p>
  </div>

  <script>
    const PASSWORD = "TBCxPayme2025";
    const REPO = "TBCxPayme/CyberSport";
    const FILE = "data.json";
    let matches = [];
    let sha = null;
    let token = "";

    // –í—Ö–æ–¥
    function login() {
      const pass = document.getElementById("passwordInput").value;
      if (pass === PASSWORD) {
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
      } else {
        document.getElementById("error").style.display = "block";
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadData() {
      token = document.getElementById("tokenInput").value.trim();
      if (!token) {
        alert("–í–≤–µ–¥–∏—Ç–µ GitHub Token!");
        return;
      }

      const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${FILE}`, {
        headers: { Authorization: `token ${token}` }
      });
      if (!res.ok) {
        document.getElementById("status").textContent = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö!";
        return;
      }

      const data = await res.json();
      sha = data.sha;
      matches = JSON.parse(atob(data.content)).matches;
      renderMatches();
      document.getElementById("status").textContent = "‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!";
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–∞—Ç—á–µ–π
    function renderMatches() {
      const container = document.getElementById("matchContainer");
      container.innerHTML = "";
      matches.forEach((m, i) => {
        container.innerHTML += `
          <div class="match">
            <input value="${m.teamA}" onchange="update(${i}, 'teamA', this.value)">
            <input type="number" value="${m.scoreA}" onchange="update(${i}, 'scoreA', this.value)">
            <span>vs</span>
            <input value="${m.teamB}" onchange="update(${i}, 'teamB', this.value)">
            <input type="number" value="${m.scoreB}" onchange="update(${i}, 'scoreB', this.value)">
          </div>`;
      });
    }

    function update(i, key, val) {
      matches[i][key] = key.includes("score") ? parseInt(val) : val;
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ GitHub
    async function saveData() {
      if (!token) {
        alert("–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º!");
        return;
      }

      const body = {
        message: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç—É—Ä–Ω–∏—Ä–∞",
        content: btoa(JSON.stringify({ matches }, null, 2)),
        sha
      };

      const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${FILE}`, {
        method: "PUT",
        headers: {
          Authorization: `token ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });

      if (res.ok) {
        document.getElementById("status").textContent = "‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!";
      } else {
        document.getElementById("status").textContent = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö!";
      }
    }
  </script>
</body>
</html>
